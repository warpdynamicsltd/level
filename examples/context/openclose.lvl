import stdlib:sys:context as *;
import stdlib:sys:app as *;

sub f()
{
  exec on_opening();
  a = mem_obj();
  b = mem_obj();
  c = mem_obj();

  echo "object without reference";
  echo mem_obj(10).m.ref_count;

  a = mem_obj(10);
  echo "referenced 1";
  echo a.m.ref_count;
  b = a;
  c = a;
  echo "referenced 3";
  echo a.m.ref_count;
  exec on_closing();
}

entry{
    exec f();
    exec gc.collect();
    exec gc.clear();
    echo "gc test";
    echo app.allocator.used;
    echo "end";
}